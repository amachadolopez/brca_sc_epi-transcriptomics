---
title: "sc-RNAseq & sc-CHIPseq analysis of breast cancer"
author: "Alba Machado-Lopez"
date: "October 2022"
output: html_document
knit: (function(input_file, encoding) {
    out_dir <- 'docs';
    rmarkdown::render(input_file,
      encoding=encoding,
      output_file=file.path(dirname(input_file), out_dir, 'index.html'))})
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Load libraries

```{r}
library(R.utils)
library(dplyr)
library(stringr)
```


# Download files

```{bash}
mkdir -p data
cd data
wget -r -np -nd 'https://ftp.ncbi.nlm.nih.gov/geo/series/GSE117nnn/GSE117309/suppl/GSE117309_RAW.tar' -R "index.html*" # Omitting the index file
```


# Decompress files

```{r, eval=FALSE}
# Untar the main file
untar("data/GSE117309_RAW.tar", exdir="data/")

# Untar sc-RNAseq files
RNA_files <- list.files(path="data/",pattern="scRNA")
untar_RNA_files <- function(file){untar(paste0("data/",file), exdir="data/")}
sapply(RNA_files, untar_RNA_files)
```

# Read files into R

## sc-ChIP files
```{r}
ChIP_files <- list.files(path="data/",pattern=".txt")

for (file in ChIP_files){
  new_name <- file %>% str_remove(".txt.gz") %>%  gsub("GSM32908.._CountTable_","",.)
  object <- read.table(paste0("data/",file), header=T)
  assign(x=new_name, object)
  rm(object, file, new_name)
}
```


# Session info

```{r}
sessionInfo()
```

